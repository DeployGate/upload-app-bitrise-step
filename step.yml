#
# A couple of useful guides & docs:
#
# - Main Bitrise CLI docs: https://github.com/bitrise-io/bitrise/tree/master/_docs
# - Step Development Guideline: https://github.com/bitrise-io/bitrise/blob/master/_docs/step-development-guideline.md
# - Bitrise.yml format spec: https://github.com/bitrise-io/bitrise/blob/master/_docs/bitrise-yml-format-spec.md
# - Bitrise docs: http://devcenter.bitrise.io/
# - Bitrise CLI guides: http://devcenter.bitrise.io/bitrise-cli/

title: |-
  DeployGate - upload a single application file
summary: |
  Upload your application file to DeployGate
description: |
  This is a step to upload your application file to DeployGate. see upload api documents #ref https://docs.deploygate.com/reference#upload
website: https://github.com/DeployGate/upload-app-bitrise-step
source_code_url: https://github.com/DeployGate/upload-app-bitrise-step
support_url: https://github.com/DeployGate/upload-app-bitrise-step/issues
host_os_tags:
  - osx-10.10
  - ubuntu-16.04

type_tags:
  - deploy

is_requires_admin_user: true
is_always_run: false
is_skippable: false
run_if: ""

deps:
  brew:
  - name: git
  - name: curl
  apt_get:
  - name: git
  - name: curl

# Entry point. Never change this.

toolkit:
  bash:
    entry_file: step.sh

# Input definitions of this step

inputs:
  - api_key: ""
    opts:
      title: "DeployGate: API Key"
      summary: "user's api key or group's api key"
      description: "The authorization token to be used when uploading app"
      is_required: true
  - owner_name: ""
    opts:
      title: "DeployGate: Owner Name"
      summary: "User name or Group name"
      description: |
        The owner name of this application
      is_required: true
  - app_path: "$BITRISE_APK_PATH"
    opts:
      title: "App file path"
      summary: "App's binary file (IPA/APK) to be uploaded"
      description: "App's binary file (IPA/APK) to be uploaded"
      is_required: true
      value_options:
        - $BITRISE_APK_PATH
        - $BITRISE_IPA_PATH
  - visibility: private
    opts:
      title: "DeployGate: app visibility"
      summary: "the visibility of this app"
      description: |
        For newly uploaded apps only, specify the app's privacy settings to either private or public. 
        By default, Personal Free Plans are set to public, and all other plans are set to private. 
        This setting does not apply for updates, and any changes made will be ignored.
      is_required: false
      value_options:
        - public
        - private
  - message: ""
    opts:
      title: "DeployGate: a short message"
      summary: "A short message to explain this version"
      description: "A short message to explain this version"
      is_required: false
  - distribution_key: ""
    opts:
      title: "DeployGate: a distribution key"
      summary: "The distribution key to be updated"
      description: |
        By specifying the distribution page's hash, that distribution page will be updated simultaneously.
        The "xxxx" portion of the distributed page's URL like /distributions/xxxx
      is_required: false
  - distribution_key: ""
    opts:
      title: "DeployGate: a distribution name"
      summary: "The distribution name to be created or be updated"
      description: |
        Specify the name of the updated distribution page. 
        If none exists, a new distribution page will be created. 
        Possible uses include creating distribution pages for each Git branch name.
      is_required: false
  - release_note: ""
    opts:
      title: "DeployGate: a release note"
      summary: "Message displayed during distribution page app updates"
      description: "Message displayed during distribution page app updates"
      is_required: false
  - disable_notify: "false"
    opts:
      title: "DeployGate: disable notify"
      summary: "(iOS only) A setting of true disables Push notification emails."
      description: "(iOS only) A setting of true disables Push notification emails."
      is_required: false
      value_options:
        - "true"
        - "false"

# Output definitions of this step.
# Need to run `envman` to export them.

outputs:
  - DEPLOYGATE_UPLOAD_APP_STEP_RESULT_JSON:
    opts:
      title: "DeployGate: API result json"
      summary: "The raw json which Upload API has returned"
      description: "The raw json which Upload API has returned"
